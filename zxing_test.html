<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Barcode Scanner Benchmark - å®Œå…¨ä¿®æ­£ç‰ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, sans-serif; margin: 16px; }
    h1 { font-size: 20px; margin: 0 0 12px; color: #333; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; margin-bottom: 8px; }
    label { display: inline-flex; align-items: center; gap: 6px; }
    select, button { font: inherit; padding: 6px 8px; border-radius: 4px; border: 1px solid #ccc; }
    button { cursor: pointer; background: #007bff; color: white; border: none; }
    button:hover { background: #0056b3; }
    button:disabled { background: #6c757d; cursor: not-allowed; }
    #video { width: min(480px, 90vw); aspect-ratio: 4 / 3; background: #000; border-radius: 8px; display: block; }
    #log { margin-top: 8px; padding: 8px; border: 1px solid #ddd; border-radius: 8px; white-space: pre-wrap; font-family: 'Courier New', monospace; min-height: 120px; max-height: 300px; overflow-y: auto; background: #f8f9fa; }
    .note { font-size: 12px; color: #666; margin: 8px 0; }
    .pill { padding: 2px 6px; border-radius: 12px; background: #e9ecef; font-size: 11px; }
    .status { padding: 4px 8px; border-radius: 4px; font-weight: bold; margin: 8px 0; }
    .status.ok { background: #d4edda; color: #155724; }
    .status.warn { background: #fff3cd; color: #856404; }
    .status.error { background: #f8d7da; color: #721c24; }
    .loading { background: #cce5ff; color: #004085; }
  </style>
</head>
<body>
  <h1>ğŸ“± Barcode Scanner Performance Benchmark</h1>

  <div class="row">
    <label>ãƒ©ã‚¤ãƒ–ãƒ©ãƒª:
      <select id="lib">
        <option value="zxing" selected>ZXing (æœ€æ–°ãƒ»æ¨å¥¨ãƒ»é«˜é€Ÿ)</option>
        <option value="quagga2">Quagga2 (å®‰å®šç‰ˆ)</option>
      </select>
    </label>

    <label>ã‚«ãƒ¡ãƒ©:
      <select id="device"></select>
    </label>

    <label>è§£åƒåº¦:
      <select id="preset">
        <option value="480p">854x480 (é«˜é€Ÿ)</option>
        <option value="720p" selected>1280x720 (æ¨™æº–)</option>
        <option value="540p">960x540 (ãƒãƒ©ãƒ³ã‚¹)</option>
      </select>
    </label>

    <span class="pill">ğŸ“š æ•™ç§‘æ›¸ISBNï¼ˆEAN-13ï¼‰æœ€é©åŒ–æ¸ˆã¿</span>
  </div>

  <div class="row">
    <button id="btnInit">ğŸ¥ ã‚«ãƒ¡ãƒ©èµ·å‹•</button>
    <button id="btnStart" disabled>ğŸ” èªè­˜é–‹å§‹</button>
    <button id="btnStop" disabled>â¹ï¸ åœæ­¢</button>
    <button id="btnTeardown" disabled>ğŸ—‘ï¸ è§£æ”¾</button>
    <button id="btnExport" disabled>ğŸ“„ CSVå‡ºåŠ›</button>
  </div>

  <div id="status" class="status loading">ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿ä¸­...</div>

  <video id="video" playsinline muted></video>
  
  <div class="note">
    ğŸ“Š <strong>è¨ˆæ¸¬é …ç›®:</strong><br>
    â€¢ èµ·å‹•æ™‚é–“: ã‚«ãƒ¡ãƒ©åˆæœŸåŒ–å®Œäº†ã¾ã§ã®æ™‚é–“<br>
    â€¢ èªè­˜æ™‚é–“: ã€Œèªè­˜é–‹å§‹ã€â†’æœ€åˆã®æ¤œå‡ºã¾ã§ã®æ™‚é–“<br>
    ğŸ“– <strong>å¯¾è±¡:</strong> æ•™ç§‘æ›¸ã«ã‚ˆãã‚ã‚‹ISBNï¼ˆEAN-13ã€978/979ã§å§‹ã¾ã‚‹13æ¡ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ï¼‰<br>
    ğŸ’¡ <strong>æ¨å¥¨:</strong> ZXing ãŒæœ€ã‚‚é«˜é€Ÿãƒ»å®‰å®šã§ã™
  </div>

  <div id="log"></div>

  <!-- æ­£ã—ã„CDNãƒ‘ã‚¹ï¼ˆæœ€æ–°ç‰ˆï¼‰ -->
  <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2@1.8.4/dist/quagga.min.js"></script>

  <script>
    // === ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===
    const $ = (s) => document.querySelector(s);
    const video = $("#video");
    const logView = $("#log");
    const statusView = $("#status");
    
    const btnInit = $("#btnInit");
    const btnStart = $("#btnStart");
    const btnStop = $("#btnStop");
    const btnTeardown = $("#btnTeardown");
    const btnExport = $("#btnExport");

    let currentAdapter = null;
    let currentStream = null;
    let t0 = 0, t1 = 0, s0 = 0, s1 = 0;
    const results = [];

    // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿ç¢ºèª
    function checkLibraries() {
      const status = {
        zxing: typeof window.ZXing !== 'undefined',
        quagga2: typeof window.Quagga2 !== 'undefined'
      };
      
      log(`ğŸ“š ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿çŠ¶æ³:`);
      log(`  âœ… ZXing: ${status.zxing ? 'åˆ©ç”¨å¯èƒ½' : 'âŒ èª­ã¿è¾¼ã¿å¤±æ•—'}`);
      log(`  ${status.quagga2 ? 'âœ…' : 'âŒ'} Quagga2: ${status.quagga2 ? 'åˆ©ç”¨å¯èƒ½' : 'èª­ã¿è¾¼ã¿å¤±æ•—'}`);
      
      if (status.zxing) {
        log(`ğŸ¯ ZXingæ¨å¥¨: æœ€é«˜é€Ÿãƒ»æœ€å®‰å®šã®ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒŠãƒ¼`);
      }
      
      return status;
    }

    // ãƒ­ã‚°é–¢æ•°
    const log = (...args) => {
      const timestamp = new Date().toLocaleTimeString();
      const message = args.join(" ");
      logView.textContent += `[${timestamp}] ${message}\n`;
      logView.scrollTop = logView.scrollHeight;
      console.log(...args);
    };

    const setStatus = (message, type = "ok") => {
      statusView.textContent = message;
      statusView.className = `status ${type}`;
    };

    // ãƒœã‚¿ãƒ³çŠ¶æ…‹ç®¡ç†
    const updateButtons = (state) => {
      const states = {
        idle: { init: false, start: true, stop: true, teardown: true, export: results.length === 0 },
        ready: { init: true, start: false, stop: true, teardown: false, export: results.length === 0 },
        scanning: { init: true, start: true, stop: false, teardown: true, export: true },
      };
      const s = states[state] || states.idle;
      btnInit.disabled = s.init;
      btnStart.disabled = s.start;
      btnStop.disabled = s.stop;
      btnTeardown.disabled = s.teardown;
      btnExport.disabled = s.export;
    };

    // ã‚«ãƒ¡ãƒ©ãƒ‡ãƒã‚¤ã‚¹ä¸€è¦§å–å¾—
    async function updateDeviceList() {
      try {
        // ä¸€æ™‚çš„ã«æ¨©é™å–å¾—ã—ã¦ãƒ©ãƒ™ãƒ«ã‚’å–å¾—
        const tempStream = await navigator.mediaDevices.getUserMedia({ video: true });
        tempStream.getTracks().forEach(track => track.stop());
        
        const devices = await navigator.mediaDevices.enumerateDevices();
        const cameras = devices.filter(d => d.kind === "videoinput");
        
        const select = $("#device");
        select.innerHTML = "";
        
        cameras.forEach(camera => {
          const option = document.createElement("option");
          option.value = camera.deviceId;
          option.textContent = camera.label || `ã‚«ãƒ¡ãƒ© ${camera.deviceId.slice(0, 8)}`;
          select.appendChild(option);
        });
        
        if (cameras.length === 0) {
          log("âš ï¸ ã‚«ãƒ¡ãƒ©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
        } else {
          log(`ğŸ“· ${cameras.length}å°ã®ã‚«ãƒ¡ãƒ©ã‚’æ¤œå‡ºã—ã¾ã—ãŸ`);
        }
      } catch (error) {
        log("âš ï¸ ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒå¿…è¦ã§ã™:", error.message);
      }
    }

    // åˆ¶ç´„ç”Ÿæˆ
    function getMediaConstraints() {
      const deviceId = $("#device").value;
      const preset = $("#preset").value;
      
      const resolutions = {
        "480p": { width: 854, height: 480 },
        "540p": { width: 960, height: 540 },
        "720p": { width: 1280, height: 720 }
      };
      
      const res = resolutions[preset] || resolutions["720p"];
      
      return {
        audio: false,
        video: {
          ...(deviceId ? { deviceId: { exact: deviceId } } : { facingMode: "environment" }),
          width: { ideal: res.width },
          height: { ideal: res.height },
          frameRate: { ideal: 30 }
        }
      };
    }

    // videoå†ç”Ÿã®å®‰å…¨å®Ÿè¡Œï¼ˆé‡è¤‡å†ç”Ÿã‚¨ãƒ©ãƒ¼é˜²æ­¢ï¼‰
    async function safePlayVideo(videoElement) {
      try {
        if (videoElement.readyState >= 2) { // HAVE_CURRENT_DATA ä»¥ä¸Š
          if (!videoElement.paused) {
            return; // æ—¢ã«å†ç”Ÿä¸­
          }
        }
        await videoElement.play();
      } catch (error) {
        if (error.name !== 'AbortError') { // æ—¢ã«å†ç”Ÿä¸­ã‚¨ãƒ©ãƒ¼ä»¥å¤–
          throw error;
        }
      }
    }

    // === ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼å®Ÿè£… ===
    const adapters = {
      // ZXing - æœ€ã‚‚å®‰å®šã§é«˜é€Ÿ
      zxing: {
        reader: null,
        scanning: false,
        
        async init() {
          if (typeof window.ZXing === 'undefined') {
            throw new Error('ZXing ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
          }
          
          t0 = performance.now();
          
          const constraints = getMediaConstraints();
          currentStream = await navigator.mediaDevices.getUserMedia(constraints);
          video.srcObject = currentStream;
          await safePlayVideo(video);
          
          // EAN-13å°‚ç”¨è¨­å®šã§é«˜é€ŸåŒ–
          const hints = new Map();
          hints.set(window.ZXing.DecodeHintType.POSSIBLE_FORMATS, [window.ZXing.BarcodeFormat.EAN_13]);
          hints.set(window.ZXing.DecodeHintType.TRY_HARDER, false); // é«˜é€Ÿå„ªå…ˆ
          
          this.reader = new window.ZXing.BrowserMultiFormatReader(hints);
          
          t1 = performance.now();
          log(`âœ… ZXing åˆæœŸåŒ–å®Œäº† (${(t1-t0).toFixed(1)}ms) - EAN-13ç‰¹åŒ–ãƒ¢ãƒ¼ãƒ‰`);
        },
        
        async startScan(onDetected) {
          if (this.scanning || !this.reader) return;
          
          this.scanning = true;
          s0 = performance.now();
          
          try {
            this.reader.decodeFromVideoElementContinuously(video, (result, err) => {
              if (result && this.scanning) {
                s1 = performance.now();
                const text = result.getText();
                const format = result.getBarcodeFormat();
                
                // ISBNåˆ¤å®šï¼ˆ978/979ã§å§‹ã¾ã‚‹13æ¡ï¼‰
                const isISBN = /^97[89]\d{10}$/.test(text);
                log(`ğŸ¯ æ¤œå‡º: ${text} ${isISBN ? 'ğŸ“š(ISBN)' : 'ğŸ“¦(ä¸€èˆ¬EAN)'}`);
                
                onDetected({ text, format, isISBN });
                this.stopScan();
              }
            });
          } catch (error) {
            this.scanning = false;
            throw error;
          }
        },
        
        async stopScan() {
          if (this.reader) {
            this.reader.reset();
          }
          this.scanning = false;
        },
        
        async cleanup() {
          await this.stopScan();
          this.reader = null;
          if (currentStream) {
            currentStream.getTracks().forEach(track => track.stop());
            currentStream = null;
          }
          video.srcObject = null;
        }
      },

      // Quagga2 - å®‰å®šç‰ˆ
      quagga2: {
        initialized: false,
        scanning: false,
        
        async init() {
          if (typeof window.Quagga2 === 'undefined') {
            throw new Error('Quagga2 ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
          }
          
          t0 = performance.now();
          
          const constraints = getMediaConstraints();
          currentStream = await navigator.mediaDevices.getUserMedia(constraints);
          video.srcObject = currentStream;
          await safePlayVideo(video);
          
          // videoè¦ç´ ã®æº–å‚™å®Œäº†ã‚’ç¢ºå®Ÿã«å¾…ã¤
          await new Promise(resolve => setTimeout(resolve, 500));
          
          await new Promise((resolve, reject) => {
            window.Quagga2.init({
              inputStream: {
                name: "Live",
                type: "LiveStream",
                target: video,
                constraints: constraints.video,
                willReadFrequently: true // Canvasæœ€é©åŒ–
              },
              decoder: {
                readers: ["ean_reader"] // EAN-13ã®ã¿
              },
              locate: true,
              locator: {
                patchSize: "medium",
                halfSample: false, // ç²¾åº¦å„ªå…ˆ
                willReadFrequently: true
              },
              numOfWorkers: Math.min(4, navigator.hardwareConcurrency || 2)
            }, (err) => {
              if (err) {
                reject(new Error(`Quagga2 åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${err.message || err}`));
              } else {
                this.initialized = true;
                resolve();
              }
            });
          });
          
          t1 = performance.now();
          log(`âœ… Quagga2 åˆæœŸåŒ–å®Œäº† (${(t1-t0).toFixed(1)}ms) - EANç‰¹åŒ–ãƒ¢ãƒ¼ãƒ‰`);
        },
        
        async startScan(onDetected) {
          if (this.scanning || !this.initialized) return;
          
          this.scanning = true;
          s0 = performance.now();
          
          // ä»¥å‰ã®ãƒãƒ³ãƒ‰ãƒ©ã‚’ã‚¯ãƒªã‚¢
          window.Quagga2.offDetected();
          
          window.Quagga2.onDetected((result) => {
            if (result?.codeResult?.code && this.scanning) {
              s1 = performance.now();
              const text = result.codeResult.code;
              const format = result.codeResult.format;
              
              const isISBN = /^97[89]\d{10}$/.test(text);
              log(`ğŸ¯ æ¤œå‡º: ${text} ${isISBN ? 'ğŸ“š(ISBN)' : 'ğŸ“¦(ä¸€èˆ¬EAN)'}`);
              
              onDetected({ text, format, isISBN });
              this.stopScan();
            }
          });
          
          window.Quagga2.start();
        },
        
        async stopScan() {
          if (this.initialized) {
            try {
              window.Quagga2.stop();
              window.Quagga2.offDetected();
            } catch (e) {
              // æ—¢ã«åœæ­¢æ¸ˆã¿ã®å ´åˆã¯ç„¡è¦–
            }
          }
          this.scanning = false;
        },
        
        async cleanup() {
          await this.stopScan();
          if (this.initialized) {
            try {
              window.Quagga2.stop();
            } catch (e) {
              // æ—¢ã«åœæ­¢æ¸ˆã¿ã®å ´åˆã¯ç„¡è¦–
            }
            this.initialized = false;
          }
          if (currentStream) {
            currentStream.getTracks().forEach(track => track.stop());
            currentStream = null;
          }
          video.srcObject = null;
        }
      }
    };

    // === ãƒ¡ã‚¤ãƒ³å‡¦ç† ===
    function getSelectedAdapter() {
      const libName = $("#lib").value;
      const adapter = adapters[libName];
      if (!adapter) {
        throw new Error(`æœªå¯¾å¿œã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª: ${libName}`);
      }
      return adapter;
    }

    function recordMeasurement(data) {
      const record = {
        timestamp: new Date().toISOString(),
        library: $("#lib").value,
        device: $("#device").selectedOptions[0]?.textContent || "unknown",
        preset: $("#preset").value,
        ...data
      };
      results.push(record);
      updateButtons(currentAdapter ? "ready" : "idle");
    }

    // CSV ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    function exportResults() {
      if (results.length === 0) {
        log("âš ï¸ å‡ºåŠ›å¯èƒ½ãªçµæœãŒã‚ã‚Šã¾ã›ã‚“");
        return;
      }
      
      const headers = ["timestamp", "library", "device", "preset", "init_time_ms", "scan_time_ms", "detected_text", "format", "is_isbn"];
      const csv = [
        headers.join(","),
        ...results.map(r => [
          r.timestamp,
          r.library,
          `"${r.device}"`,
          r.preset,
          r.init_time_ms || "",
          r.scan_time_ms || "",
          `"${r.detected_text || ""}"`,
          r.format || "",
          r.is_isbn || false
        ].join(","))
      ].join("\n");
      
      const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `barcode_benchmark_${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.csv`;
      a.click();
      URL.revokeObjectURL(url);
      
      log(`ğŸ“„ ${results.length}ä»¶ã®çµæœã‚’CSVã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ`);
    }

    // === ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ ===
    btnInit.onclick = async () => {
      try {
        setStatus("åˆæœŸåŒ–ä¸­...", "warn");
        updateButtons("idle");
        
        if (currentAdapter) {
          await currentAdapter.cleanup();
        }
        
        currentAdapter = getSelectedAdapter();
        t0 = t1 = s0 = s1 = 0;
        
        await currentAdapter.init();
        
        const libName = $("#lib").value;
        setStatus(`${libName} ã‚«ãƒ¡ãƒ©æº–å‚™å®Œäº† - èªè­˜é–‹å§‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„`, "ok");
        updateButtons("ready");
        
        recordMeasurement({
          init_time_ms: (t1 - t0).toFixed(1),
          scan_time_ms: "",
          detected_text: "",
          format: "",
          is_isbn: false
        });
        
      } catch (error) {
        log("âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:", error.message);
        setStatus("åˆæœŸåŒ–å¤±æ•— - åˆ¥ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è©¦ã—ã¦ãã ã•ã„", "error");
        updateButtons("idle");
      }
    };

    btnStart.onclick = async () => {
      if (!currentAdapter) return;
      
      try {
        setStatus("ğŸ“± ã‚¹ã‚­ãƒ£ãƒ³ä¸­ - ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ã‚«ãƒ¡ãƒ©ã«å‘ã‘ã¦ãã ã•ã„", "warn");
        updateButtons("scanning");
        
        s0 = s1 = 0;
        
        await currentAdapter.startScan((result) => {
          const scanTime = s1 - s0;
          log(`âš¡ èªè­˜å®Œäº†: ${scanTime.toFixed(1)}ms ã§æ¤œå‡º`);
          
          setStatus(`âœ… æ¤œå‡ºå®Œäº†: ${result.text}`, "ok");
          updateButtons("ready");
          
          recordMeasurement({
            init_time_ms: (t1 - t0).toFixed(1),
            scan_time_ms: scanTime.toFixed(1),
            detected_text: result.text,
            format: result.format,
            is_isbn: result.isISBN || false
          });
        });
        
      } catch (error) {
        log("âŒ ã‚¹ã‚­ãƒ£ãƒ³ã‚¨ãƒ©ãƒ¼:", error.message);
        setStatus("ã‚¹ã‚­ãƒ£ãƒ³å¤±æ•—", "error");
        updateButtons("ready");
      }
    };

    btnStop.onclick = async () => {
      if (currentAdapter) {
        await currentAdapter.stopScan();
        setStatus("ã‚¹ã‚­ãƒ£ãƒ³åœæ­¢", "ok");
        updateButtons("ready");
        log("â¹ï¸ ã‚¹ã‚­ãƒ£ãƒ³ã‚’åœæ­¢ã—ã¾ã—ãŸ");
      }
    };

    btnTeardown.onclick = async () => {
      if (currentAdapter) {
        await currentAdapter.cleanup();
        currentAdapter = null;
        setStatus("è§£æ”¾å®Œäº† - æ–°ã—ã„ãƒ†ã‚¹ãƒˆãŒå¯èƒ½ã§ã™", "ok");
        updateButtons("idle");
        log("ğŸ—‘ï¸ ãƒªã‚½ãƒ¼ã‚¹ã‚’è§£æ”¾ã—ã¾ã—ãŸ");
      }
    };

    btnExport.onclick = exportResults;

    // === åˆæœŸåŒ– ===
    window.addEventListener('load', async () => {
      try {
        // å°‘ã—å¾…ã£ã¦ã‹ã‚‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèªï¼ˆå®Œå…¨èª­ã¿è¾¼ã¿å¾…ã¡ï¼‰
        await new Promise(resolve => setTimeout(resolve, 100));
        
        const libStatus = checkLibraries();
        
        if (!libStatus.zxing && !libStatus.quagga2) {
          throw new Error('åˆ©ç”¨å¯èƒ½ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚ã‚Šã¾ã›ã‚“');
        }
        
        // ZXingãŒåˆ©ç”¨å¯èƒ½ã§ãªã„å ´åˆã€Quagga2ã«åˆ‡ã‚Šæ›¿ãˆ
        if (!libStatus.zxing && libStatus.quagga2) {
          $("#lib").value = "quagga2";
          log("ğŸ”„ ZXing ãŒåˆ©ç”¨ã§ããªã„ãŸã‚ Quagga2 ã‚’é¸æŠ");
        }
        
        await updateDeviceList();
        log("ğŸš€ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æº–å‚™å®Œäº†");
        log("ğŸ“– ä½¿ç”¨æ–¹æ³•:");
        log("  1. ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’é¸æŠ (ZXingæ¨å¥¨)");
        log("  2. ã‚«ãƒ¡ãƒ©ã‚’é¸æŠ");
        log("  3. è§£åƒåº¦ã‚’é¸æŠ");
        log("  4. ã‚«ãƒ¡ãƒ©èµ·å‹• â†’ èªè­˜é–‹å§‹");
        log("ğŸ“š ISBNå¯¾å¿œ: 978/979ã§å§‹ã¾ã‚‹13æ¡ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’æ¤œå‡ºã—ã¾ã™");
        
        setStatus("æº–å‚™å®Œäº† - ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã—ã¦ãã ã•ã„", "ok");
        updateButtons("idle");
        
      } catch (error) {
        log("âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:", error.message);
        setStatus("åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ - ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„", "error");
      }
    });
  </script>
</body>
</html>
